{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="row profile-container">
    <div class="col-12">
        <h2>Your Profile</h2>
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-4 text-center">
                <img src="{{ request.user.socialaccount_set.all.0.get_avatar_url }}" alt="" class="profile-image">
            </div>
            <div class="col-8">
                <p>{{ user.socialaccount_set.all.0.extra_data.name }}</p>
                <p>{{ user }}</p>
                <p>{{ email }}</p>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-4 pt-3">
                <a href="{% url 'user_profile' template_target='billing' %}"
                    class="btn btn-info w-100 rounded-0 profile-btn profile-btn-selected">Billing Details</a>
                <a href="{% url 'user_profile' template_target='delivery' %}"
                    class="btn btn-info w-100 rounded-0">Delivery Adresses</a>
                <a href="{% url 'user_profile' template_target='favourites' %}"
                    class="btn btn-info w-100 rounded-0">Favourite Products</a>
                <a href="{% url 'user_profile' template_target='orders' %}" class="btn btn-info w-100 rounded-0">Order
                    History</a>
            </div>
            <div class="col-8">
                {% if target == 'billing' %}
                <form class="mt-3" action="{% url 'user_profile' template_target='billing' %}" method="POST">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <button class="btn btn-success rounded-0 text-uppercase float-right">Update Info</button>
                </form>
                {% elif target == 'delivery' %}
                {% if delivery_addresses %}
                <div class="row">
                    <div class="col-6">
                        <table class="table table-responsive table-borderless">
                            <thead>
                                <tr>
                                    <th class="w-100">Saved Delivery Addresses</th>
                                </tr>
                            </thead>
                            {% for address in delivery_addresses %}

                            <tr>
                                <td class="w-100">
                                    <a href="{% url 'update_delivery_address' address.id %}" class="delivery_btn">
                                        {{ address.address_ref }}
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'delete_delivery_address' address.id %}"
                                        class="text-danger delivery-delete">
                                        <span class="icon">
                                            <i class="fas fa-trash fa-lg"></i>
                                        </span>
                                    </a>
                                </td>
                            </tr>


                            {% comment %} <div class="row">
                                <div class="col-10">
                                    <a href="{% url 'update_delivery_address' address.id %}" class="btn delivery_btn">
                                        {{ address.address_ref }}
                                    </a>
                                </div>
                                <div class="col-2">
                                    <a href="">
                                        <span class="icon">
                                            <i class="fas fa-trash text-danger"></i>
                                        </span>
                                    </a>
                                </div>
                            </div> {% endcomment %}
                            {% endfor %}
                        </table>
                        <p>
                            <a href="{% url 'add_delivery_address' template_target='delivery' %}"
                                class="btn btn-info rounded-0">
                                Add a new delivery address
                            </a>
                        </p>
                    </div>
                    <div class="col-6">
                        saved contacts
                    </div>
                </div>
                {% else %}
                <form class="mt-3" action="{% url 'user_profile' template_target=target %}" method="POST">
                    {% csrf_token %}
                    {{ form|crispy }}
                    {% if updating %}
                    <input type="hidden" name="updating" value="{{ address_id }}">
                    {% endif %}
                    <button class="btn btn-success rounded-0 text-uppercase float-right">
                        Update Delivery Address
                    </button>
                </form>
                {% endif %}
                {% elif target == "favourites"%}
                <p>favourite products here</p>
                {% else %}
                <p>order history here</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}