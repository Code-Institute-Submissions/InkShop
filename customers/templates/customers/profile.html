{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="row profile-container">
    <div class="col-12 text-center m-5">
        <h2>Your Profile</h2>
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-4 text-center">
                {% if user.profile_pic_url %}
                <img src="{{ user.profile_pic_url }}" alt="user.full_name" class="profile-image">
                {% else %}
                <img src="{{ MEDIA_URL }}no_profile_pic.png" alt="" class="profile-image">
                {% endif %}
            </div>
            <div class="col-8">
                {% if user.full_name %}
                <p>{{ user.full_name }}</p>
                {% else %}
                <p>Please enter your full name below.</p>
                {% endif %}
                <p>email: {{ email }}</p>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="row">
            <div class="col-4 pt-3">
                <a href="{% url 'user_profile' template_target='billing' %}" class="btn w-100 rounded-0 profile-btn"
                    id="billing">Billing Details</a>
                <a href="{% url 'user_profile' template_target='delivery' %}" class="btn w-100 rounded-0 profile-btn"
                    id="delivery">Delivery Addresses</a>
                <a href="{% url 'user_profile' template_target='favourites' %}" class="btn w-100 rounded-0 profile-btn"
                    id="favourites">Favourite Products</a>
                <a href=" {% url 'user_profile' template_target='orders' %}" class="btn w-100 rounded-0 profile-btn"
                    id="orders">Order
                    History</a>
            </div>
            <div class="col-8">
                {% if target == 'billing' %}
                <form class="mt-3" action="{% url 'user_profile' template_target='billing' %}" method="POST">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <button class="btn btn-success rounded-0 text-uppercase float-right">Update Info</button>
                </form>
                {% elif target == 'delivery' %}
                {% if delivery_addresses %}
                <div class="row">
                    <div class="col-6">
                        <table class="table table-responsive table-borderless">
                            <thead>
                                <tr>
                                    <th class="w-100">Saved Delivery Addresses</th>
                                </tr>
                            </thead>
                            {% for address in delivery_addresses %}

                            <tr>
                                <td class="w-100">
                                    <a href="{% url 'update_delivery_address' address.id %}" class="delivery_btn">
                                        {{ address.address_ref }}
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'delete_delivery_address' address.id %}"
                                        class="text-danger delivery-delete">
                                        <span class="icon">
                                            <i class="fas fa-trash fa-lg"></i>
                                        </span>
                                        <input type="hidden" name="deleting" value="deleting">
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </table>
                        <p>
                            <a href="{% url 'add_delivery_address' template_target='delivery' %}"
                                class="btn btn-info rounded-0">
                                Add a new delivery address
                            </a>
                        </p>
                    </div>
                    <div class="col-6">
                        saved contacts
                    </div>
                </div>
                {% else %}
                <h5 class="mt-3">You can save as many delivery addresses as you like but you have yet to save any.
                    Please do so below.</h5>
                <form class="mt-3" action="{% url 'user_profile' template_target=target %}" method="POST">
                    {% csrf_token %}
                    {{ form|crispy }}
                    {% if updating %}
                    <input type="hidden" name="updating" value="{{ address_id }}">
                    {% endif %}
                    <button class="btn btn-success rounded-0 text-uppercase float-right">
                        Update Delivery Address
                    </button>
                </form>
                {% endif %}
                {% elif target == "favourites"%}
                {% include 'customers/includes/favourite_products.html' %}
                {% else %}
                <p>order history here</p>
                {% for order in user.orders.all %}
                {{order.order_number}}
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
{% include 'customers/includes/profile_btn_selected_js.html' %}
{% endblock %}