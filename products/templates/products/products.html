{% extends 'base.html' %}

{% load static %}

{% block content %}
<div class="row products-container">
    {% if search %}
    <div class="col-12">
        <h4>Your search for "{{ search }}" returned the following results</h4>
        <hr>
    </div>
    {% endif %}
    <div class="col-3 product-filters">
        <div class="card filters-card border-0">
            <div class="row no-gutters">
                <div class="col-12">
                    <div class="card-title text-center pt-2">
                        <h4>Filters</h4>
                        <p id="message"></p>
                    </div>
                    <div class="col-12">
                        <div class="card-body">
                            <div class="row">
                                {% for filter in filters %}
                                <div class="col-12">
                                    <a data-filter-value="{{ filter }}" id="{{ filter }}"
                                        class="btn rounded-1 border-0 w-100 mt-1 filter-btn-unchecked">
                                        {{ filter }}
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-9">
        {% for product in products %}
        <div class="card product-list rounded-1 border-0" id="{{ product.id }}">
            <div class="row no-gutters">
                <div class="col-3">
                    <img class="card-img" src="{{ product.img }}" alt="{{ product.name }}">
                </div>
                <div class="col-6">
                    <div class="card-body">
                        <h5 class="card-title"><strong>{{ product.title }}</strong></h5>
                        <p class="card-text pt-4">{{ product.description }}
                            <hr>
                        </p>
                        {% for info in product_info %}
                        {% if product.id == info.id %}
                        <p>
                            {% if info.pages %}Prints up to {{ info.pages }}<br>{% endif %}
                            {% if info.volume %}Contains {{ info.volume }}<br>{% endif %}
                            {% if info.colour %}Colour:
                            <span data-prod-id="{{ info.id }}">{{ info.colour }}</span><br>
                            {% endif %}
                        </p>
                        {% endif %}
                        {% endfor %}
                        {% if product.blurb %}
                        <a href="#blurb_{{product.id}}" data-toggle="collapse"><small>more
                                info</small></a>&nbsp;&nbsp;&nbsp;
                        {% endif %}
                        <a href="#compat_{{product.id}}" data-toggle="collapse"><small>printer compatibility</small></a>
                        <div class="collapse" data-item_id="{{ product.id }}" id="blurb_{{ product.id }}">
                            <p><small>{{ product.blurb |safe }}</small></p>
                        </div>
                        <div class="collapse" data-item_id="{{ product.id }}" id="compat_{{ product.id }}">
                            <p><small>{{ product.features |safe }}</small></p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="col-12 pricing">
                        <strong>€0.00 <span class="text-muted">inc VAT<span></strong>
                    </div>
                    <div class="col-12 pricing">
                        <small class="text-muted">€0.00 ex VAT</small>
                    </div>
                    <div class="col-12 pricing">
                        quantity selector goes here
                    </div>

                    <div class="col-12 pricing add-to-basket-btn">
                        <a href="#" class="btn btn-success w-100 rounded-0 border-0">Add to Basket</a>
                    </div>
                </div>
            </div>
        </div>

        {% endfor %}
    </div>

</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}

<script type="text/javascript">
    var filterValues = [];
    {% for filter in filters %}
        filterValues.push(`{{ filter }}`);
    {% endfor %}

    var productInfos = [];
    {% for info in product_info %}
        var productObj = {};
        productObj['id'] = "{{ info.id }}";
        productObj['colour'] = "{{ info.colour }}";
        productInfos.push(productObj);
    {% endfor %}

    for (i = 0; i < filterValues.length; i++) {
        var message_filter = document.getElementById(`${filterValues[i]}`);
        message_filter.addEventListener('click', function () {
            for (x = 0; x < productInfos.length; x++) {
                $(`#${productInfos[x]['id']}`).show();
            }
            $(".filter-btn-checked").removeClass("filter-btn-checked").addClass("filter-btn-unchecked");

            if ($(this).hasClass("filter-btn-unchecked")) {
                    $(this).removeClass("filter-btn-unchecked").addClass("filter-btn-checked");
                    for (x = 0; x < productInfos.length; x++) {
                        if(productInfos[x]['colour'] != this.id) {
                            $(`#${productInfos[x]['id']}`).hide();
                        }
                    }
            } else if ($(this).hasClass("filter-btn-checked")) {
                    $(this).removeClass("filter-btn-checked").addClass("filter-btn-unchecked");
                    for (x = 0; x < productInfos.length; x++) {
                        if(productInfos[x]['colour'] != this.id) {
                            $(`#${productInfos[x]['id']}`).show();
                        }
                    }
            }
        })
    } 
</script>


{% endblock %}